<script>
    import { createLogger } from '../utils/logger';
    import type { ILogger } from '../types';

    const logger: ILogger = createLogger({ prefix: 'CodeBlock' });

    /**
     * Handles the click event on the copy button, copies the code within the associated <pre> element to the clipboard,
     * and provides visual feedback to the user.
     *
     * @param button - The HTML button element that was clicked.
     * @param code - The code text to be copied to the clipboard.
     */
    const handleCopyClick = (button: HTMLButtonElement, code: string) => {
        try {
            navigator.clipboard.writeText(code);

            button.textContent = 'Copied!';
            button.classList.add('has-passed');

            setTimeout(() => {
                button.textContent = 'Copy';
                button.classList.remove('has-passed');
            }, 1000);

            logger.info('Code copied to clipboard');
        } catch (err) {
            logger.error('Failed to copy code to clipboard:', err);

            button.textContent = 'Error!';
            button.classList.add('has-failed');

            setTimeout(() => {
                button.textContent = 'Copy';
                button.classList.remove('has-failed');
            }, 1000);
        }
    };

    document.addEventListener('click', (e: MouseEvent) => {
        const target = e.target as Element;
        const button = target.closest('.copy-button');

        if (button instanceof HTMLButtonElement) {
            const pre = button.closest('pre');
            const code = pre?.querySelector('code')?.textContent || '';

            e.preventDefault();

            handleCopyClick(button, code);
        }
    });
</script>
